<!DOCTYPE html>
<html ng-app="myApp">
<head>
	<meta charset="utf-8">
	<title>Add a customer</title>
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet" type="text/css">
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js" type="text/javascript"></script>
	<script src="/assets/factory.js" type="text/javascript"></script>
	<script src="/assets/filter.js" type="text/javascript"></script>
	
	<script type="text/javascript">
	angular.module("myApp", ["myFactorys", "myFilters"])

	.controller("customerCtrl", function($scope, customerFactory) {
		var now = new Date();
		$scope.customers = [];
		customerFactory.getCustomers(function(data) {
			$scope.customers = data;
		})

		$scope.error = false;

		$scope.predicate = "-created_at";

		$scope.removeCustomer = function(customer) {
			$scope.customers.splice($scope.customers.indexOf(customer), 1);
		}

		$scope.addCustomer = function() {
			$scope.error = false;
			console.log($scope.new_customer);
			for(customer in $scope.customers) {
				if($scope.customers[customer].name == $scope.new_customer || $scope.new_customer ==  undefined) {
					// console.log($scope.new_customer);
					$scope.error =true;
				}
			}

			if(!$scope.error) {
				var date = new Date();
				$scope.customers.push({name: $scope.new_customer, created_at: date});
				$scope.new_customer = "";
			}
		}
	});
	</script>
</head>
<body ng-controller="customerCtrl">
	<div class="container">
		<h1>Add a new customer</h1>
		<label>Customer Name: </label>
		<input type="text" ng-model="new_customer">
		<button class="btn btn-primary" ng-click="addCustomer()">Add</button>

		<div class="bg-danger col-md-3" ng-show="error">Errors Duplicated date</div>
		<div class="text-right">
			<input type="text" ng-model="query" placeholder="search name...">
		</div>
		<table class="table table-striped table-hover">
			<thead>
				<tr>
					<th>
						<a href="" ng-click="predicate = 'name'; reverse=false">Customer Name</a>
						(<a href="" ng-click="predicate = '-name'; reverse!=reverse">^</a>)
					</th>
					<th>
						<a href="" ng-click="predicate = 'created_at'; reverse=false">Created Date</a>
						(<a href="" ng-click="predicate = '-created_at'; reverse=false">^</a>)
					</th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="customer in customers | filter: query | orderBy: predicate:reverse">
					<td ng-bind="customer.name"></td>
					<td>{{customer.created_at | date: "MMMM dd yyyy"}}</td>
					<td><button class="btn btn-danger" ng-click="removeCustomer(customer)">Remove</button></td>
				</tr>
			</tbody>
		</table>
	</div>
</body>
</html>
